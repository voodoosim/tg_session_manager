=====================================
File: ./src/tg_session_manager/__init__.py
=====================================
"""í…”ë ˆê·¸ë¨ ì„¸ì…˜ ê´€ë¦¬ íŒ¨í‚¤ì§€"""

# íŒ¨í‚¤ì§€ ë ˆë²¨ importë¥¼ ìœ„í•œ ì„¤ì •
__all__ = [
    "APIManager",
    "SessionBase",
    "SessionFactory",
    "TelethonSession",
    "PyrogramSession",
    "TelegramBotSession",
    "TDLibSession",
    "SessionLogger",
    "extract_session_name",
    "session_to_base64",
    "base64_to_session",
    "validate_session_file",
    "backup_existing_session",
]



=====================================
File: ./src/tg_session_manager/cli/__init__.py
=====================================



=====================================
File: ./src/tg_session_manager/cli/main.py
=====================================
"""
ë©”ì¸ CLI ì• í”Œë¦¬ì¼€ì´ì…˜ - ì „ì²´ í”Œë¡œìš° ê´€ë¦¬
"""

import asyncio
import os
import sys
from typing import Dict, List

from core.api_manager import APIManager
from config.config import MAX_RETRY_ATTEMPTS, SESSION_DIRS
from utils.logger import SessionLogger
from core.session_factory import SessionFactory
from utils.session_utils import backup_existing_session, extract_session_name


class TelegramSessionManager:
    """í…”ë ˆê·¸ë¨ ì„¸ì…˜ ê´€ë¦¬ ë©”ì¸ í´ë˜ìŠ¤"""

    def __init__(self):
        self.api_manager = APIManager()
        self.results: List[Dict] = []
        self.logger = SessionLogger()

    def print_colored(self, text: str, color: str = "white"):
        """ìƒ‰ìƒ ì¶œë ¥ (ì„ íƒì )"""
        colors = {
            "red": "\033[91m",
            "green": "\033[92m",
            "yellow": "\033[93m",
            "blue": "\033[94m",
            "magenta": "\033[95m",
            "cyan": "\033[96m",
            "white": "\033[97m",
            "reset": "\033[0m",
        }
        print(f"{colors.get(color, '')}{text}{colors['reset']}")

    def select_or_register_api(self) -> Dict[str, str]:
        """API ì„ íƒ ë˜ëŠ” ë“±ë¡"""
        apis = self.api_manager.list_apis()

        if apis:
            self.print_colored("\nğŸ“‹ ë“±ë¡ëœ API ëª©ë¡:", "cyan")
            for i, api_name in enumerate(apis, 1):
                print(f"  {i}. {api_name}")
            print(f"  {len(apis) + 1}. ìƒˆ API ë“±ë¡")

            choice = input("\nì„ íƒí•˜ì„¸ìš”: ")
            if choice.isdigit() and 1 <= int(choice) <= len(apis):
                api_name = apis[int(choice) - 1]
                return self.api_manager.get_api(api_name)

        # ìƒˆ API ë“±ë¡
        self.print_colored("\nğŸ”‘ ìƒˆ API ë“±ë¡", "yellow")
        name = input("API ì´ë¦„: ")
        api_id = input("API ID: ")
        api_hash = input("API Hash: ")

        self.api_manager.register_api(name, api_id, api_hash)
        self.logger.log_api_registered(name)
        self.print_colored("âœ… API ë“±ë¡ ì™„ë£Œ!", "green")
        return {"api_id": api_id, "api_hash": api_hash}

    def select_libraries(self) -> List[str]:
        """ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ"""
        selected = []

        self.print_colored("\nğŸ“š ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš” (ì‰¼í‘œë¡œ êµ¬ë¶„):", "cyan")
        print("  1. Telethon (ìœ ì € ì„¸ì…˜)")
        print("  2. Pyrogram (ìœ ì € ì„¸ì…˜)")
        print("  3. python-telegram-bot (ë´‡ ì „ìš©)")
        print("  4. TDLib (ê³ ì„±ëŠ¥ C++ ê¸°ë°˜)")

        choices = input("\nì„ íƒ (ì˜ˆ: 1,2): ").split(",")

        library_map = {
            "1": "telethon",
            "2": "pyrogram",
            "3": "telegram-bot",
            "4": "tdlib",
        }

        for choice in choices:
            lib = library_map.get(choice.strip())
            if lib:
                selected.append(lib)

        if selected:
            self.print_colored(f"âœ… ì„ íƒëœ ë¼ì´ë¸ŒëŸ¬ë¦¬: {', '.join(selected)}", "green")

        return selected

    def input_phone_numbers(self) -> List[str]:
        """ì „í™”ë²ˆí˜¸ ì…ë ¥"""
        self.print_colored("\nğŸ“± ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì‰¼í‘œë¡œ êµ¬ë¶„):", "cyan")
        print("   ì˜ˆ) +821012345678, +821087654321")
        phones = input("\nì…ë ¥: ")
        phone_list = [phone.strip() for phone in phones.split(",") if phone.strip()]

        if phone_list:
            self.print_colored(f"âœ… ì…ë ¥ëœ ë²ˆí˜¸: {len(phone_list)}ê°œ", "green")

        return phone_list

    async def create_sessions(
        self, api_config: Dict[str, str], libraries: List[str], phones: List[str]
    ):
        """ì„¸ì…˜ ìƒì„± ë©”ì¸ ë¡œì§"""
        total_tasks = len(libraries) * len(phones)
        current_task = 0

        self.print_colored(f"\nğŸš€ ì´ {total_tasks}ê°œ ì„¸ì…˜ ìƒì„± ì‹œì‘...", "magenta")
        print("=" * 60)

        for library in libraries:
            for phone in phones:
                current_task += 1
                self.print_colored(
                    f"\n[{current_task}/{total_tasks}] ì²˜ë¦¬ ì¤‘...", "blue"
                )

                success = await self._create_single_session(api_config, library, phone)

                self.results.append(
                    {"library": library, "phone": phone, "success": success}
                )

    async def _create_single_session(
        self, api_config: Dict[str, str], library: str, phone: str
    ) -> bool:
        """ë‹¨ì¼ ì„¸ì…˜ ìƒì„±"""
        manager = SessionFactory.create_session_manager(
            library, api_config["api_id"], api_config["api_hash"]
        )

        if not manager:
            self.print_colored(f"âŒ {library} ë§¤ë‹ˆì € ìƒì„± ì‹¤íŒ¨", "red")
            return False

        # ê¸°ì¡´ ì„¸ì…˜ í™•ì¸ ë° ë°±ì—…
        session_name = extract_session_name(phone)
        session_path = os.path.join(SESSION_DIRS[library], f"{session_name}.session")

        if os.path.exists(session_path):
            self.print_colored(f"âš ï¸  ê¸°ì¡´ ì„¸ì…˜ ë°œê²¬: {session_name}", "yellow")
            backup_path = backup_existing_session(session_path)
            if backup_path:
                self.print_colored(
                    f"ğŸ’¾ ë°±ì—… ì™„ë£Œ: {os.path.basename(backup_path)}", "green"
                )
                self.logger.log_backup(session_path, backup_path)

        print(f"\nğŸ”„ [{library}] {phone} ì„¸ì…˜ ìƒì„± ì¤‘...")

        for attempt in range(MAX_RETRY_ATTEMPTS):
            try:

                def code_callback():
                    code = input(
                        f"ğŸ“² ì¸ì¦ ì½”ë“œ ì…ë ¥ ({attempt + 1}/{MAX_RETRY_ATTEMPTS}): "
                    )
                    self.logger.log_authentication(phone, attempt + 1, bool(code))
                    return code

                def password_callback():
                    return input(
                        f"ğŸ” 2FA ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ({attempt + 1}/{MAX_RETRY_ATTEMPTS}): "
                    )

                success = await manager.create_session(
                    phone, code_callback, password_callback
                )

                if success:
                    self.print_colored("âœ… ì„¸ì…˜ ìƒì„± ì„±ê³µ!", "green")
                    self.logger.log_session_created(library, phone, True)

                    # Base64 ë¬¸ìì—´ ìƒì„±
                    base64_str = manager.session_to_string(phone)
                    if base64_str:
                        self.print_colored(f"ğŸ”¤ Base64: {base64_str[:50]}...", "cyan")

                    return True

            except Exception as e:
                self.print_colored(f"âŒ ì‹œë„ {attempt + 1} ì‹¤íŒ¨: {e}", "red")
                self.logger.log_error(str(e))

        self.print_colored(f"âŒ {phone} ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨ (ìµœëŒ€ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼)", "red")
        self.logger.log_session_created(library, phone, False)
        return False

    def print_results(self):
        """ì „ì²´ ê²°ê³¼ ì¶œë ¥"""
        print("\n" + "=" * 60)
        self.print_colored("ğŸ“Š ì „ì²´ ê²°ê³¼ ìš”ì•½", "magenta")
        print("=" * 60)

        success_count = sum(1 for r in self.results if r["success"])
        total_count = len(self.results)
        fail_count = total_count - success_count

        # ì„±ê³µë¥  ê³„ì‚°
        success_rate = (success_count / total_count * 100) if total_count > 0 else 0

        # ìš”ì•½ ì •ë³´
        self.print_colored(f"\nâœ… ì„±ê³µ: {success_count}ê°œ", "green")
        self.print_colored(f"âŒ ì‹¤íŒ¨: {fail_count}ê°œ", "red")
        self.print_colored(f"ğŸ“ˆ ì„±ê³µë¥ : {success_rate:.1f}%", "cyan")

        # ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ í†µê³„
        print("\nğŸ“š ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ í†µê³„:")
        lib_stats = {}
        for result in self.results:
            lib = result["library"]
            if lib not in lib_stats:
                lib_stats[lib] = {"success": 0, "fail": 0}
            if result["success"]:
                lib_stats[lib]["success"] += 1
            else:
                lib_stats[lib]["fail"] += 1

        for lib, stats in lib_stats.items():
            total = stats["success"] + stats["fail"]
            print(f"  â€¢ {lib}: {stats['success']}/{total} ì„±ê³µ")

        # ìƒì„¸ ê²°ê³¼
        print("\nğŸ“‹ ìƒì„¸ ê²°ê³¼:")
        print("-" * 60)
        print(f"{'ìƒíƒœ':^6} | {'ë¼ì´ë¸ŒëŸ¬ë¦¬':^15} | {'ì „í™”ë²ˆí˜¸':^20}")
        print("-" * 60)

        for result in self.results:
            status = "âœ…" if result["success"] else "âŒ"
            color = "green" if result["success"] else "red"
            self.print_colored(
                f"{status:^6} | {result['library']:^15} | {result['phone']:^20}", color
            )
        print("-" * 60)

    async def run(self):
        """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
        self.print_colored("ğŸš€ í…”ë ˆê·¸ë¨ ë©€í‹° ì„¸ì…˜ ê´€ë¦¬ì v1.0", "magenta")
        print("=" * 60)

        try:
            # 1. API ì„ íƒ/ë“±ë¡
            api_config = self.select_or_register_api()

            # 2. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ
            libraries = self.select_libraries()
            if not libraries:
                self.print_colored("âš ï¸  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ íƒí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.", "yellow")
                return

            # 3. ì „í™”ë²ˆí˜¸ ì…ë ¥
            phones = self.input_phone_numbers()
            if not phones:
                self.print_colored("âš ï¸  ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.", "yellow")
                return

            # 4. ì„¸ì…˜ ìƒì„±
            await self.create_sessions(api_config, libraries, phones)

            # 5. ê²°ê³¼ ì¶œë ¥
            self.print_results()

        except KeyboardInterrupt:
            self.print_colored("\n\nâš ï¸  ì‚¬ìš©ìì— ì˜í•´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.", "yellow")
            self.logger.log_error("ì‚¬ìš©ì ì¤‘ë‹¨")
        except Exception as e:
            self.print_colored(f"\nâŒ ì˜¤ë¥˜ ë°œìƒ: {e}", "red")
            self.logger.log_error(str(e))

        self.print_colored("\nğŸ‘‹ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.", "cyan")


if __name__ == "__main__":
    # Windows í™˜ê²½ì—ì„œ ì»¬ëŸ¬ ì¶œë ¥ í™œì„±í™”
    if sys.platform.startswith("win"):
        os.system("color")

    manager = TelegramSessionManager()
    asyncio.run(manager.run())



=====================================
File: ./src/tg_session_manager/cli/main_fixed.py
=====================================
# main.pyì˜ ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ë§Œ ìˆ˜ì •
# _create_single_session ë©”ì„œë“œ ë‚´ë¶€ì˜ ì½”ë“œ ìˆ˜ì •

async def _create_single_session(self, api_config: Dict[str, str], 
                               library: str, phone: str) -> bool:
    """ë‹¨ì¼ ì„¸ì…˜ ìƒì„±"""
    manager = SessionFactory.create_session_manager(
        library, api_config['api_id'], api_config['api_hash']
    )
    
    if not manager:
        self.print_colored(f"âŒ {library} ë§¤ë‹ˆì € ìƒì„± ì‹¤íŒ¨", "red")
        return False
    
    # ê¸°ì¡´ ì„¸ì…˜ í™•ì¸ ë° ë°±ì—…
    session_name = extract_session_name(phone)
    session_path = os.path.join(SESSION_DIRS[library], f"{session_name}.session")
    
    if os.path.exists(session_path):
        self.print_colored(f"âš ï¸  ê¸°ì¡´ ì„¸ì…˜ ë°œê²¬: {session_name}", "yellow")
        backup_path = backup_existing_session(session_path)
        if backup_path:
            self.print_colored(f"ğŸ’¾ ë°±ì—… ì™„ë£Œ: {os.path.basename(backup_path)}", "green")
            self.logger.log_backup(session_path, backup_path)
    
    print(f"\nğŸ”„ [{library}] {phone} ì„¸ì…˜ ìƒì„± ì¤‘...")
    
    for attempt in range(MAX_RETRY_ATTEMPTS):
        try:
            # í´ë¡œì € ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ ê¸°ë³¸ê°’ ì¸ì ì‚¬ìš©
            def make_code_callback(attempt_num=attempt):
                def code_callback():
                    code = input(f"ğŸ“² ì¸ì¦ ì½”ë“œ ì…ë ¥ ({attempt_num + 1}/{MAX_RETRY_ATTEMPTS}): ")
                    self.logger.log_authentication(phone, attempt_num + 1, bool(code))
                    return code
                return code_callback
            
            def make_password_callback(attempt_num=attempt):
                def password_callback():
                    return input(f"ğŸ” 2FA ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ({attempt_num + 1}/{MAX_RETRY_ATTEMPTS}): ")
                return password_callback
            
            success = await manager.create_session(
                phone, make_code_callback(), make_password_callback()
            )
            
            if success:
                self.print_colored("âœ… ì„¸ì…˜ ìƒì„± ì„±ê³µ!", "green")
                self.logger.log_session_created(library, phone, True)
                
                # Base64 ë¬¸ìì—´ ìƒì„±
                base64_str = manager.session_to_string(phone)
                if base64_str:
                    self.print_colored(f"ğŸ”¤ Base64: {base64_str[:50]}...", "cyan")
                
                return True
                
        except (IOError, OSError, RuntimeError) as e:
            self.print_colored(f"âŒ ì‹œë„ {attempt + 1} ì‹¤íŒ¨: {e}", "red")
            self.logger.log_error(str(e))
    
    self.print_colored(f"âŒ {phone} ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨ (ìµœëŒ€ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼)", "red")
    self.logger.log_session_created(library, phone, False)
    return False



=====================================
File: ./src/tg_session_manager/config/__init__.py
=====================================



=====================================
File: ./src/tg_session_manager/config/config.py
=====================================
"""
í™˜ê²½ ì„¤ì • ë° ìƒìˆ˜ ê´€ë¦¬ ëª¨ë“ˆ
"""

import os
from typing import Dict

# ê¸°ë³¸ ê²½ë¡œ ì„¤ì •
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
SESSIONS_DIR = os.path.join(BASE_DIR, "sessions")
API_CONFIG_FILE = os.path.join(BASE_DIR, "api_configs.json")

# ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ ì„¸ì…˜ ë””ë ‰í† ë¦¬
SESSION_DIRS: Dict[str, str] = {
    "telethon": os.path.join(SESSIONS_DIR, "telethon"),
    "pyrogram": os.path.join(SESSIONS_DIR, "pyrogram"),
    "telegram-bot": os.path.join(SESSIONS_DIR, "telegram-bot"),
    "tdlib": os.path.join(SESSIONS_DIR, "tdlib"),
}

# ê¸°ë³¸ ì„¤ì •ê°’
MAX_RETRY_ATTEMPTS = 3
DEFAULT_TIMEOUT = 60

# ë””ë ‰í† ë¦¬ ìƒì„±
for dir_path in SESSION_DIRS.values():
    os.makedirs(dir_path, exist_ok=True)



=====================================
File: ./src/tg_session_manager/core/__init__.py
=====================================



=====================================
File: ./src/tg_session_manager/core/api_manager.py
=====================================
"""
API ì •ë³´ ê´€ë¦¬ ëª¨ë“ˆ - api_id/api_hash ë“±ë¡, ì¡°íšŒ, ì €ì¥
"""

import json
import os
from typing import Dict, List, Optional

from config.config import API_CONFIG_FILE


class APIManager:
    """í…”ë ˆê·¸ë¨ API ì •ë³´ë¥¼ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤"""

    def __init__(self):
        self.api_configs: Dict[str, Dict[str, str]] = self._load_configs()

    def _load_configs(self) -> Dict[str, Dict[str, str]]:
        """JSON íŒŒì¼ì—ì„œ API ì„¤ì • ë¡œë“œ"""
        if os.path.exists(API_CONFIG_FILE):
            try:
                with open(API_CONFIG_FILE, "r", encoding="utf-8") as f:
                    return json.load(f)
            except (json.JSONDecodeError, IOError) as e:
                print(f"API ì„¤ì • ë¡œë“œ ì‹¤íŒ¨: {e}")
        return {}

    def save_configs(self) -> None:
        """API ì„¤ì •ì„ JSON íŒŒì¼ì— ì €ì¥"""
        try:
            with open(API_CONFIG_FILE, "w", encoding="utf-8") as f:
                json.dump(self.api_configs, f, indent=2)
        except IOError as e:
            print(f"API ì„¤ì • ì €ì¥ ì‹¤íŒ¨: {e}")

    def register_api(self, name: str, api_id: str, api_hash: str) -> bool:
        """ìƒˆë¡œìš´ API ì •ë³´ ë“±ë¡"""
        self.api_configs[name] = {"api_id": api_id, "api_hash": api_hash}
        self.save_configs()
        return True

    def get_api(self, name: str) -> Optional[Dict[str, str]]:
        """ë“±ë¡ëœ API ì •ë³´ ì¡°íšŒ"""
        return self.api_configs.get(name)

    def list_apis(self) -> List[str]:
        """ë“±ë¡ëœ ëª¨ë“  API ì´ë¦„ ë°˜í™˜"""
        return list(self.api_configs.keys())



=====================================
File: ./src/tg_session_manager/core/session_base.py
=====================================
"""
ì„¸ì…˜ ê´€ë¦¬ ì¶”ìƒ í´ë˜ìŠ¤ - ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
"""

from abc import ABC, abstractmethod
from typing import Dict, Optional


class SessionBase(ABC):
    """ì„¸ì…˜ ê´€ë¦¬ë¥¼ ìœ„í•œ ì¶”ìƒ ê¸°ë°˜ í´ë˜ìŠ¤"""

    def __init__(self, api_id: str, api_hash: str, session_dir: str):
        self.api_id = api_id
        self.api_hash = api_hash
        self.session_dir = session_dir

    @abstractmethod
    async def create_session(
        self, phone_number: str, code_callback=None, password_callback=None
    ) -> bool:
        """ì„¸ì…˜ ìƒì„± - êµ¬í˜„ í•„ìˆ˜"""

    @abstractmethod
    def session_to_string(self, phone_number: str) -> Optional[str]:
        """ì„¸ì…˜ì„ base64 ë¬¸ìì—´ë¡œ ë³€í™˜"""

    @abstractmethod
    def validate_session(self, phone_number: str) -> bool:
        """ì„¸ì…˜ ìœ íš¨ì„± ê²€ì‚¬"""

    @abstractmethod
    def get_session_info(self, phone_number: str) -> Optional[Dict]:
        """ì„¸ì…˜ ì •ë³´ ì¡°íšŒ"""



=====================================
File: ./src/tg_session_manager/core/session_factory.py
=====================================
"""
ì„¸ì…˜ íŒ©í† ë¦¬ - ë¼ì´ë¸ŒëŸ¬ë¦¬ëª…ì— ë”°ë¼ ì ì ˆí•œ ì„¸ì…˜ ë§¤ë‹ˆì € ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
"""

from typing import Optional

from config.config import SESSION_DIRS
from lib.pyrogram_session import PyrogramSession
from core.session_base import SessionBase
from lib.tdlib_session import TDLibSession
from lib.telegram_bot_session import TelegramBotSession
from lib.telethon_session import TelethonSession


class SessionFactory:
    """ì„¸ì…˜ ë§¤ë‹ˆì € íŒ©í† ë¦¬ í´ë˜ìŠ¤"""

    @staticmethod
    def create_session_manager(
        library: str, api_id: str, api_hash: str
    ) -> Optional[SessionBase]:
        """ë¼ì´ë¸ŒëŸ¬ë¦¬ëª…ì— ë”°ë¼ ì„¸ì…˜ ë§¤ë‹ˆì € ì¸ìŠ¤í„´ìŠ¤ ìƒì„±"""
        library = library.lower()

        if library not in SESSION_DIRS:
            print(f"ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬: {library}")
            return None

        session_dir = SESSION_DIRS[library]

        if library == "telethon":
            return TelethonSession(api_id, api_hash, session_dir)
        elif library == "pyrogram":
            return PyrogramSession(api_id, api_hash, session_dir)
        elif library == "telegram-bot":
            return TelegramBotSession(api_id, api_hash, session_dir)
        elif library == "tdlib":
            return TDLibSession(api_id, api_hash, session_dir)

        return None



=====================================
File: ./src/tg_session_manager/gui/__init__.py
=====================================



=====================================
File: ./src/tg_session_manager/gui/dialogs/__init__.py
=====================================



=====================================
File: ./src/tg_session_manager/gui/dialogs/auth_dialog.py
=====================================
"""
ì¸ì¦ ì •ë³´ ì…ë ¥ ë‹¤ì´ì–¼ë¡œê·¸
"""
from PyQt5.QtWidgets import (
    QDialog, QVBoxLayout, QHBoxLayout, QLabel,
    QLineEdit, QPushButton, QDialogButtonBox,
    QMessageBox
)
from PyQt5.QtCore import Qt
from PyQt5.QtGui import QFont
from typing import Optional, Dict


class AuthDialog(QDialog):
    """ì¸ì¦ ì •ë³´ ì…ë ¥ ë‹¤ì´ì–¼ë¡œê·¸"""

    def __init__(self, parent, library: str, phone: str):
        super().__init__(parent)
        self.library = library
        self.phone = phone
        self.auth_data = None

        self.setup_ui()

    def setup_ui(self):
        """UI êµ¬ì„±"""
        self.setWindowTitle(f"ì¸ì¦ - {self.library}")
        self.setModal(True)
        self.setFixedSize(450, 250)

        layout = QVBoxLayout(self)
        layout.setSpacing(15)

        # í—¤ë”
        header_layout = QVBoxLayout()

        title_label = QLabel(f"{self.library} ì¸ì¦")
        title_font = QFont()
        title_font.setPointSize(12)
        title_font.setBold(True)
        title_label.setFont(title_font)
        title_label.setAlignment(Qt.AlignCenter)
        header_layout.addWidget(title_label)

        phone_label = QLabel(f"ì „í™”ë²ˆí˜¸: {self.phone}")
        phone_label.setAlignment(Qt.AlignCenter)
        phone_label.setStyleSheet("color: #0d7377;")
        header_layout.addWidget(phone_label)

        layout.addLayout(header_layout)

        # êµ¬ë¶„ì„ 
        line = QLabel()
        line.setFrameStyle(QLabel.HLine | QLabel.Sunken)
        layout.addWidget(line)

        # ì¸ì¦ ì½”ë“œ ì…ë ¥
        code_layout = QHBoxLayout()
        code_layout.addWidget(QLabel("ì¸ì¦ ì½”ë“œ:"))

        self.code_input = QLineEdit()
        self.code_input.setPlaceholderText("í…”ë ˆê·¸ë¨ì—ì„œ ë°›ì€ ì½”ë“œ ì…ë ¥")
        self.code_input.setMaxLength(10)
        code_layout.addWidget(self.code_input)

        layout.addLayout(code_layout)

        # 2FA ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
        password_layout = QHBoxLayout()
        password_layout.addWidget(QLabel("2FA ë¹„ë°€ë²ˆí˜¸:"))

        self.password_input = QLineEdit()
        self.password_input.setEchoMode(QLineEdit.Password)
        self.password_input.setPlaceholderText("ì„ íƒì‚¬í•­ - 2ë‹¨ê³„ ì¸ì¦ ì„¤ì •í•œ ê²½ìš°")
        password_layout.addWidget(self.password_input)

        layout.addLayout(password_layout)

        # ë²„íŠ¼
        button_box = QDialogButtonBox()

        ok_button = button_box.addButton("í™•ì¸", QDialogButtonBox.AcceptRole)
        skip_button = button_box.addButton("ê±´ë„ˆë›°ê¸°", QDialogButtonBox.RejectRole)

        ok_button.clicked.connect(self.on_ok_clicked)
        skip_button.clicked.connect(self.reject)

        layout.addWidget(button_box)

        # í¬ì»¤ìŠ¤ ì„¤ì •
        self.code_input.setFocus()

        # Enter í‚¤ ë°”ì¸ë”©
        self.code_input.returnPressed.connect(self.on_ok_clicked)
        self.password_input.returnPressed.connect(self.on_ok_clicked)

    def on_ok_clicked(self):
        """í™•ì¸ ë²„íŠ¼ í´ë¦­"""
        code = self.code_input.text().strip()

        if not code:
            QMessageBox.warning(
                self,
                "ê²½ê³ ",
                "ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”."
            )
            self.code_input.setFocus()
            return

        self.auth_data = {
            'code': code,
            'password': self.password_input.text().strip() or None
        }

        self.accept()

    def get_auth_data(self) -> Optional[Dict[str, str]]:
        """ì¸ì¦ ë°ì´í„° ë°˜í™˜"""
        return self.auth_data



=====================================
File: ./src/tg_session_manager/gui/dialogs/session_detail_dialog.py
=====================================
"""
ì„¸ì…˜ ë¬¸ìì—´ ìƒì„¸ ë³´ê¸° ë‹¤ì´ì–¼ë¡œê·¸
"""
from PyQt5.QtCore import Qt
from PyQt5.QtGui import QClipboard, QFont
from PyQt5.QtWidgets import (QApplication, QDialog, QHBoxLayout, QLabel,
                             QMessageBox, QPushButton, QTextEdit, QVBoxLayout)


class SessionDetailDialog(QDialog):
    """ì„¸ì…˜ ìƒì„¸ ì •ë³´ ë‹¤ì´ì–¼ë¡œê·¸"""

    def __init__(self, parent, phone: str, library: str, session_string: str):
        super().__init__(parent)
        self.phone = phone
        self.library = library
        self.session_string = session_string

        self.setup_ui()

    def setup_ui(self):
        """UI êµ¬ì„±"""
        self.setWindowTitle(f"ì„¸ì…˜ ë¬¸ìì—´ - {self.phone}")
        self.setModal(True)
        self.resize(700, 500)

        layout = QVBoxLayout(self)

        # í—¤ë”
        header_layout = QVBoxLayout()

        title_label = QLabel(f"{self.library} ì„¸ì…˜")
        title_font = QFont()
        title_font.setPointSize(12)
        title_font.setBold(True)
        title_label.setFont(title_font)
        title_label.setAlignment(Qt.AlignCenter)
        header_layout.addWidget(title_label)

        phone_label = QLabel(f"ì „í™”ë²ˆí˜¸: {self.phone}")
        phone_label.setAlignment(Qt.AlignCenter)
        phone_label.setStyleSheet("color: #0d7377;")
        header_layout.addWidget(phone_label)

        layout.addLayout(header_layout)

        # êµ¬ë¶„ì„ 
        line = QLabel()
        line.setFrameStyle(QLabel.HLine | QLabel.Sunken)
        layout.addWidget(line)

        # ì •ë³´ ë ˆì´ë¸”
        info_label = QLabel(
            "ì•„ë˜ ë¬¸ìì—´ì€ ì„¸ì…˜ íŒŒì¼ì˜ Base64 ì¸ì½”ë”©ì…ë‹ˆë‹¤.\n"
            "ì´ ë¬¸ìì—´ì„ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ê³  í•„ìš”í•  ë•Œ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        )
        info_label.setWordWrap(True)
        info_label.setStyleSheet("color: #888888; padding: 10px;")
        layout.addWidget(info_label)

        # ì„¸ì…˜ ë¬¸ìì—´ í‘œì‹œ
        self.text_edit = QTextEdit()
        self.text_edit.setPlainText(self.session_string)
        self.text_edit.setReadOnly(True)
        self.text_edit.setFont(QFont("Consolas", 10))
        layout.addWidget(self.text_edit)

        # í†µê³„ ì •ë³´
        stats_label = QLabel(f"ë¬¸ìì—´ ê¸¸ì´: {len(self.session_string):,} ë¬¸ì")
        stats_label.setStyleSheet("color: #666666;")
        layout.addWidget(stats_label)

        # ë²„íŠ¼ ë ˆì´ì•„ì›ƒ
        button_layout = QHBoxLayout()

        copy_btn = QPushButton("í´ë¦½ë³´ë“œì— ë³µì‚¬")
        copy_btn.clicked.connect(self.copy_to_clipboard)
        button_layout.addWidget(copy_btn)

        select_all_btn = QPushButton("ì „ì²´ ì„ íƒ")
        select_all_btn.clicked.connect(self.text_edit.selectAll)
        button_layout.addWidget(select_all_btn)

        close_btn = QPushButton("ë‹«ê¸°")
        close_btn.clicked.connect(self.accept)
        button_layout.addWidget(close_btn)

        button_layout.addStretch()
        layout.addLayout(button_layout)

    def copy_to_clipboard(self):
        """í´ë¦½ë³´ë“œì— ë³µì‚¬"""
        clipboard = QApplication.clipboard()
        clipboard.setText(self.session_string)

        QMessageBox.information(
            self,
            "ë³µì‚¬ ì™„ë£Œ",
            "ì„¸ì…˜ ë¬¸ìì—´ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤."
        )



=====================================
File: ./src/tg_session_manager/gui/qt_main.py
=====================================
#!/usr/bin/env python3
"""
í…”ë ˆê·¸ë¨ ì„¸ì…˜ ê´€ë¦¬ì PyQt5 GUI - ë‹¤í¬ ë¸”ë£¨ í…Œë§ˆ
"""
import os
import sys

sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from gui.qt_main_window import MainWindow
from gui.themes.dark_theme import apply_dark_theme
from PyQt5.QtCore import Qt
from PyQt5.QtGui import QFont
from PyQt5.QtWidgets import QApplication


def main():
    """ë©”ì¸ í•¨ìˆ˜"""
    # ê³ í•´ìƒë„ ë””ìŠ¤í”Œë ˆì´ ì§€ì›
    if hasattr(Qt, 'AA_EnableHighDpiScaling'):
        QApplication.setAttribute(Qt.AA_EnableHighDpiScaling, True)
    if hasattr(Qt, 'AA_UseHighDpiPixmaps'):
        QApplication.setAttribute(Qt.AA_UseHighDpiPixmaps, True)

    # ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±
    app = QApplication(sys.argv)
    app.setApplicationName("Telegram Session Manager")
    app.setOrganizationName("TelegramTools")

    # í°íŠ¸ ì„¤ì • (ì„ íƒì‚¬í•­)
    font = QFont("Segoe UI", 10)
    app.setFont(font)

    # ë‹¤í¬ í…Œë§ˆ ì ìš©
    apply_dark_theme(app)

    # ë©”ì¸ ìœˆë„ìš° ìƒì„± ë° í‘œì‹œ
    window = MainWindow()
    window.setWindowTitle("í…”ë ˆê·¸ë¨ ì„¸ì…˜ ê´€ë¦¬ì - Dark Blue Theme")
    window.show()

    # ì´ë²¤íŠ¸ ë£¨í”„ ì‹¤í–‰
    sys.exit(app.exec_())


if __name__ == "__main__":
    try:
        main()
    except Exception as e:
        print(f"ì˜¤ë¥˜ ë°œìƒ: {e}")
        input("Enterë¥¼ ëˆŒëŸ¬ ì¢…ë£Œ...")



=====================================
File: ./src/tg_session_manager/gui/qt_main_window.py
=====================================
"""
PyQt5 ë©”ì¸ ìœˆë„ìš°
"""
from PyQt5.QtWidgets import (
    QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,
    QTabWidget, QStatusBar, QMessageBox, QFileDialog
)
from PyQt5.QtCore import Qt, pyqtSignal, QThread
from PyQt5.QtGui import QPalette, QColor
import json
from datetime import datetime
from typing import Dict, List

from gui.widgets.api_frame import APIFrame
from gui.widgets.input_frame import InputFrame
from gui.widgets.result_frame import ResultFrame
from gui.workers.session_worker import SessionWorker
from core.api_manager import APIManager
from utils.logger import SessionLogger


class MainWindow(QMainWindow):
    """ë©”ì¸ ìœˆë„ìš° í´ë˜ìŠ¤"""

    # ì‹œê·¸ë„ ì •ì˜
    session_created = pyqtSignal(dict)
    log_message = pyqtSignal(str)

    def __init__(self):
        super().__init__()
        self.setWindowTitle("í…”ë ˆê·¸ë¨ ì„¸ì…˜ ê´€ë¦¬ì v2.0")
        self.setGeometry(100, 100, 1200, 800)
        self.setMinimumSize(1000, 600)

        # ë³€ìˆ˜ ì´ˆê¸°í™”
        self.api_manager = APIManager()
        self.logger = SessionLogger()
        self.current_api = None
        self.session_strings = {}  # {phone: {library: base64_string}}
        self.worker = None
        self.worker_thread = None

        # UI ì„¤ì •
        self.setup_ui()

        # ì‹œê·¸ë„ ì—°ê²°
        self.connect_signals()

        # ìƒíƒœ í‘œì‹œì¤„ ì´ˆê¸°í™”
        self.status_bar.showMessage("ì¤€ë¹„ë¨")

    def setup_ui(self):
        """UI êµ¬ì„±"""
        # ì¤‘ì•™ ìœ„ì ¯
        central_widget = QWidget()
        self.setCentralWidget(central_widget)

        # ë©”ì¸ ë ˆì´ì•„ì›ƒ
        main_layout = QVBoxLayout(central_widget)
        main_layout.setContentsMargins(10, 10, 10, 10)

        # API í”„ë ˆì„
        self.api_frame = APIFrame(self.api_manager)
        main_layout.addWidget(self.api_frame)

        # ì…ë ¥ í”„ë ˆì„
        self.input_frame = InputFrame()
        main_layout.addWidget(self.input_frame)

        # ê²°ê³¼ í”„ë ˆì„
        self.result_frame = ResultFrame()
        main_layout.addWidget(self.result_frame)

        # ìƒíƒœ í‘œì‹œì¤„
        self.status_bar = QStatusBar()
        self.setStatusBar(self.status_bar)

    def connect_signals(self):
        """ì‹œê·¸ë„ ì—°ê²°"""
        # API í”„ë ˆì„ ì‹œê·¸ë„
        self.api_frame.api_selected.connect(self.on_api_selected)
        self.api_frame.api_registered.connect(self.on_api_registered)

        # ì…ë ¥ í”„ë ˆì„ ì‹œê·¸ë„
        self.input_frame.start_processing.connect(self.start_session_creation)
        self.input_frame.stop_processing.connect(self.stop_session_creation)

        # ê²°ê³¼ í”„ë ˆì„ ì‹œê·¸ë„
        self.result_frame.copy_requested.connect(self.copy_session_string)
        self.result_frame.export_requested.connect(self.export_all_sessions)
        self.result_frame.clear_requested.connect(self.clear_results)
        self.result_frame.session_double_clicked.connect(self.show_session_details)

        # ë‚´ë¶€ ì‹œê·¸ë„
        self.session_created.connect(self.on_session_created)
        self.log_message.connect(self.add_log)

    def on_api_selected(self, api_config: Dict):
        """API ì„ íƒ ì´ë²¤íŠ¸"""
        self.current_api = api_config
        self.add_log(f"API ì„ íƒë¨: {api_config.get('name', 'Unknown')}")

    def on_api_registered(self, api_name: str):
        """API ë“±ë¡ ì´ë²¤íŠ¸"""
        self.logger.log_api_registered(api_name)
        self.add_log(f"ìƒˆ API ë“±ë¡ë¨: {api_name}")

    def start_session_creation(self, data: Dict):
        """ì„¸ì…˜ ìƒì„± ì‹œì‘"""
        if not self.current_api:
            QMessageBox.warning(self, "ê²½ê³ ", "ë¨¼ì € APIë¥¼ ì„ íƒí•˜ì„¸ìš”.")
            return

        libraries = data['libraries']
        phones = data['phones']

        if not libraries:
            QMessageBox.warning(self, "ê²½ê³ ", "ìµœì†Œ í•˜ë‚˜ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.")
            return

        if not phones:
            QMessageBox.warning(self, "ê²½ê³ ", "ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
            return

        # ì§„í–‰ ìƒíƒœ ì´ˆê¸°í™”
        total_tasks = len(libraries) * len(phones)
        self.input_frame.set_progress_max(total_tasks)
        self.input_frame.set_progress_value(0)
        self.input_frame.set_processing(True)

        # ì›Œì»¤ ìŠ¤ë ˆë“œ ìƒì„±
        self.worker_thread = QThread()
        self.worker = SessionWorker(
            self.current_api,
            libraries,
            phones
        )

        self.worker.moveToThread(self.worker_thread)

        # ì‹œê·¸ë„ ì—°ê²°
        self.worker_thread.started.connect(self.worker.run)
        self.worker.progress.connect(self.update_progress)
        self.worker.session_created.connect(self.session_created.emit)
        self.worker.log_message.connect(self.log_message.emit)
        self.worker.auth_required.connect(self.handle_auth_required)
        self.worker.finished.connect(self.on_processing_finished)
        self.worker.finished.connect(self.worker_thread.quit)
        self.worker.finished.connect(self.worker.deleteLater)
        self.worker_thread.finished.connect(self.worker_thread.deleteLater)

        # ìŠ¤ë ˆë“œ ì‹œì‘
        self.worker_thread.start()

        self.status_bar.showMessage(f"ì„¸ì…˜ ìƒì„± ì¤‘... (ì´ {total_tasks}ê°œ)")
        self.add_log(f"ì„¸ì…˜ ìƒì„± ì‹œì‘: {total_tasks}ê°œ ì‘ì—…")

    def stop_session_creation(self):
        """ì„¸ì…˜ ìƒì„± ì¤‘ì§€"""
        if self.worker:
            self.worker.stop()
            self.add_log("ì‚¬ìš©ìì— ì˜í•´ ì¤‘ì§€ ìš”ì²­ë¨")

    def handle_auth_required(self, data: Dict):
        """ì¸ì¦ ìš”ì²­ ì²˜ë¦¬"""
        from gui.dialogs.auth_dialog import AuthDialog

        dialog = AuthDialog(
            self,
            data['library'],
            data['phone']
        )

        if dialog.exec_():
            auth_data = dialog.get_auth_data()
            if self.worker:
                self.worker.provide_auth(auth_data)
        else:
            if self.worker:
                self.worker.provide_auth(None)

    def update_progress(self, value: int):
        """ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸"""
        self.input_frame.set_progress_value(value)

    def on_session_created(self, result: Dict):
        """ì„¸ì…˜ ìƒì„± ì™„ë£Œ ì´ë²¤íŠ¸"""
        phone = result['phone']
        library = result['library']

        if result['success']:
            # ë©”ëª¨ë¦¬ì— ì €ì¥
            if phone not in self.session_strings:
                self.session_strings[phone] = {}
            self.session_strings[phone][library] = result['session_string']

            # UIì— ì¶”ê°€
            self.result_frame.add_result({
                'phone': phone,
                'library': library,
                'status': 'ì„±ê³µ',
                'string_preview': result['session_string'][:50] + '...'
            })

            self.logger.log_session_created(library, phone, True)
        else:
            self.result_frame.add_result({
                'phone': phone,
                'library': library,
                'status': 'ì‹¤íŒ¨',
                'string_preview': result.get('error', 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜')
            })

            self.logger.log_session_created(library, phone, False)

    def on_processing_finished(self):
        """ì²˜ë¦¬ ì™„ë£Œ"""
        self.input_frame.set_processing(False)
        self.status_bar.showMessage("ì„¸ì…˜ ìƒì„± ì™„ë£Œ")
        self.add_log("ëª¨ë“  ì‘ì—… ì™„ë£Œ")

        # ê²°ê³¼ ìš”ì•½
        total = len(self.result_frame.get_all_results())
        success = len([r for r in self.result_frame.get_all_results()
                      if r['status'] == 'ì„±ê³µ'])
        self.add_log(f"ê²°ê³¼: ì„±ê³µ {success}/{total}")

    def copy_session_string(self, phone: str, library: str):
        """ì„¸ì…˜ ë¬¸ìì—´ ë³µì‚¬"""
        if phone in self.session_strings and library in self.session_strings[phone]:
            from PyQt5.QtWidgets import QApplication
            clipboard = QApplication.clipboard()
            clipboard.setText(self.session_strings[phone][library])

            self.status_bar.showMessage("í´ë¦½ë³´ë“œì— ë³µì‚¬ë¨", 3000)
            self.add_log(f"ì„¸ì…˜ ë¬¸ìì—´ ë³µì‚¬ë¨: {phone} - {library}")

    def show_session_details(self, phone: str, library: str):
        """ì„¸ì…˜ ìƒì„¸ ì •ë³´ í‘œì‹œ"""
        if phone in self.session_strings and library in self.session_strings[phone]:
            from gui.dialogs.session_detail_dialog import SessionDetailDialog

            dialog = SessionDetailDialog(
                self,
                phone,
                library,
                self.session_strings[phone][library]
            )
            dialog.exec_()

    def export_all_sessions(self):
        """ëª¨ë“  ì„¸ì…˜ ë‚´ë³´ë‚´ê¸°"""
        if not self.session_strings:
            QMessageBox.warning(self, "ê²½ê³ ", "ë‚´ë³´ë‚¼ ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.")
            return

        filename, _ = QFileDialog.getSaveFileName(
            self,
            "ì„¸ì…˜ ë‚´ë³´ë‚´ê¸°",
            f"sessions_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json",
            "JSON Files (*.json);;All Files (*.*)"
        )

        if filename:
            try:
                export_data = {
                    'exported_at': datetime.now().isoformat(),
                    'version': '2.0',
                    'sessions': self.session_strings
                }

                with open(filename, 'w', encoding='utf-8') as f:
                    json.dump(export_data, f, indent=2, ensure_ascii=False)

                QMessageBox.information(
                    self,
                    "ì„±ê³µ",
                    f"ì„¸ì…˜ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤:\n{filename}"
                )
                self.add_log(f"ì„¸ì…˜ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ: {filename}")

            except Exception as e:
                QMessageBox.critical(
                    self,
                    "ì˜¤ë¥˜",
                    f"ì €ì¥ ì‹¤íŒ¨: {str(e)}"
                )

    def clear_results(self):
        """ê²°ê³¼ ì´ˆê¸°í™”"""
        self.session_strings.clear()
        self.add_log("ê²°ê³¼ ëª©ë¡ ì´ˆê¸°í™”ë¨")

    def add_log(self, message: str):
        """ë¡œê·¸ ì¶”ê°€"""
        self.result_frame.add_log(message)



=====================================
File: ./src/tg_session_manager/gui/run_qt_gui.py
=====================================



=====================================
File: ./src/tg_session_manager/gui/themes/__init__.py
=====================================



=====================================
File: ./src/tg_session_manager/gui/themes/dark_theme.py
=====================================
"""
ëˆˆì´ í¸ì•ˆí•œ ë‹¤í¬ ë¸”ë£¨ í…Œë§ˆ
"""

DARK_BLUE_THEME = """
/* ì „ì²´ ë°°ê²½ ë° ê¸°ë³¸ ìƒ‰ìƒ */
QWidget {
    background-color: #0a0e1a;
    color: #e0e6f0;
    font-family: 'Segoe UI', 'Noto Sans', Arial, sans-serif;
    font-size: 13px;
}

QMainWindow {
    background-color: #0a0e1a;
}

QGroupBox {
    background-color: #0f1420;
    border: 2px solid #1e2940;
    border-radius: 8px;
    margin-top: 10px;
    padding-top: 10px;
    font-weight: bold;
}

QGroupBox::title {
    subcontrol-origin: margin;
    left: 10px;
    padding: 0 10px 0 10px;
    color: #4a9eff;
}

QPushButton {
    background-color: #1a3a52;
    color: #ffffff;
    border: 1px solid #2a5a7a;
    border-radius: 6px;
    padding: 8px 16px;
    font-weight: 500;
    min-height: 28px;
}

QPushButton:hover {
    background-color: #245580;
    border: 1px solid #3a7aa0;
}

QPushButton:pressed {
    background-color: #163045;
    border: 1px solid #2a5a7a;
}

QPushButton:disabled {
    background-color: #151d2a;
    color: #4a5568;
    border: 1px solid #1a2332;
}

QPushButton#startButton {
    background-color: #2563eb;
    font-weight: bold;
}

QPushButton#startButton:hover {
    background-color: #3b82f6;
}

QLineEdit, QTextEdit, QPlainTextEdit {
    background-color: #0d1117;
    color: #e0e6f0;
    border: 1px solid #1e2940;
    border-radius: 4px;
    padding: 6px;
    selection-background-color: #2563eb;
    selection-color: #ffffff;
}

QLineEdit:focus, QTextEdit:focus, QPlainTextEdit:focus {
    border: 1px solid #3b82f6;
    background-color: #0f1420;
}

QComboBox {
    background-color: #0d1117;
    color: #e0e6f0;
    border: 1px solid #1e2940;
    border-radius: 4px;
    padding: 6px;
    min-height: 28px;
}

QComboBox:hover {
    border: 1px solid #3b82f6;
}

QComboBox::drop-down {
    border: none;
    width: 20px;
}

QComboBox::down-arrow {
    image: none;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid #4a9eff;
    margin-right: 5px;
}

QComboBox QAbstractItemView {
    background-color: #0d1117;
    color: #e0e6f0;
    selection-background-color: #2563eb;
    border: 1px solid #1e2940;
}

QCheckBox {
    spacing: 8px;
    color: #e0e6f0;
}

QCheckBox::indicator {
    width: 18px;
    height: 18px;
    border-radius: 3px;
    border: 2px solid #1e2940;
    background-color: #0d1117;
}

QCheckBox::indicator:checked {
    background-color: #2563eb;
    border: 2px solid #3b82f6;
}

QCheckBox::indicator:hover {
    border: 2px solid #3b82f6;
}

QTreeWidget {
    background-color: #0d1117;
    color: #e0e6f0;
    border: 1px solid #1e2940;
    border-radius: 4px;
    outline: none;
}

QTreeWidget::item {
    padding: 4px;
    border-radius: 4px;
}

QTreeWidget::item:hover {
    background-color: #1a2332;
}

QTreeWidget::item:selected {
    background-color: #2563eb;
    color: #ffffff;
}

QHeaderView::section {
    background-color: #0f1420;
    color: #4a9eff;
    border: none;
    border-bottom: 2px solid #1e2940;
    padding: 6px;
    font-weight: bold;
}

QTabWidget::pane {
    background-color: #0f1420;
    border: 1px solid #1e2940;
    border-radius: 4px;
}

QTabBar::tab {
    background-color: #0a0e1a;
    color: #8b92a0;
    padding: 8px 16px;
    margin-right: 2px;
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
}

QTabBar::tab:selected {
    background-color: #0f1420;
    color: #4a9eff;
    border-bottom: 2px solid #2563eb;
}

QTabBar::tab:hover {
    background-color: #1a2332;
    color: #e0e6f0;
}

QProgressBar {
    background-color: #0d1117;
    border: 1px solid #1e2940;
    border-radius: 4px;
    text-align: center;
    color: #ffffff;
    height: 24px;
}

QProgressBar::chunk {
    background-color: #2563eb;
    border-radius: 3px;
}

QScrollBar:vertical {
    background-color: #0a0e1a;
    width: 12px;
    border-radius: 6px;
}

QScrollBar::handle:vertical {
    background-color: #1e2940;
    border-radius: 6px;
    min-height: 30px;
}

QScrollBar::handle:vertical:hover {
    background-color: #2a3a50;
}

QScrollBar:horizontal {
    background-color: #0a0e1a;
    height: 12px;
    border-radius: 6px;
}

QScrollBar::handle:horizontal {
    background-color: #1e2940;
    border-radius: 6px;
    min-width: 30px;
}

QScrollBar::handle:horizontal:hover {
    background-color: #2a3a50;
}

QScrollBar::add-line, QScrollBar::sub-line {
    border: none;
    background: none;
}

QStatusBar {
    background-color: #0a0e1a;
    color: #8b92a0;
    border-top: 1px solid #1e2940;
}

QMenu {
    background-color: #0d1117;
    color: #e0e6f0;
    border: 1px solid #1e2940;
    border-radius: 4px;
    padding: 4px;
}

QMenu::item {
    padding: 6px 20px;
    border-radius: 4px;
}

QMenu::item:selected {
    background-color: #2563eb;
    color: #ffffff;
}

QToolTip {
    background-color: #1a2332;
    color: #e0e6f0;
    border: 1px solid #2a3a50;
    border-radius: 4px;
    padding: 4px;
}

QLabel {
    color: #e0e6f0;
}

QLabel#infoLabel {
    color: #4a9eff;
    font-weight: 500;
}

QLabel#errorLabel {
    color: #f87171;
}

QLabel#successLabel {
    color: #34d399;
}

QDialog {
    background-color: #0a0e1a;
}

QDialogButtonBox QPushButton {
    min-width: 80px;
}

QMessageBox {
    background-color: #0a0e1a;
}

QMessageBox QLabel {
    color: #e0e6f0;
}

QSplitter::handle {
    background-color: #1e2940;
}

QSplitter::handle:hover {
    background-color: #2a3a50;
}
"""

def apply_dark_theme(app):
    """ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë‹¤í¬ í…Œë§ˆ ì ìš©"""
    app.setStyleSheet(DARK_BLUE_THEME)

    # ì¶”ê°€ íŒ”ë ˆíŠ¸ ì„¤ì •
    from PyQt5.QtCore import Qt
    from PyQt5.QtGui import QColor, QPalette

    palette = QPalette()
    palette.setColor(QPalette.Window, QColor(10, 14, 26))
    palette.setColor(QPalette.WindowText, QColor(224, 230, 240))
    palette.setColor(QPalette.Base, QColor(13, 17, 23))
    palette.setColor(QPalette.AlternateBase, QColor(15, 20, 32))
    palette.setColor(QPalette.ToolTipBase, QColor(26, 35, 50))
    palette.setColor(QPalette.ToolTipText, QColor(224, 230, 240))
    palette.setColor(QPalette.Text, QColor(224, 230, 240))
    palette.setColor(QPalette.Button, QColor(26, 58, 82))
    palette.setColor(QPalette.ButtonText, QColor(255, 255, 255))
    palette.setColor(QPalette.BrightText, QColor(74, 158, 255))
    palette.setColor(QPalette.Link, QColor(37, 99, 235))
    palette.setColor(QPalette.Highlight, QColor(37, 99, 235))
    palette.setColor(QPalette.HighlightedText, QColor(255, 255, 255))

    app.setPalette(palette)



=====================================
File: ./src/tg_session_manager/gui/widgets/__init__.py
=====================================



=====================================
File: ./src/tg_session_manager/gui/widgets/api_frame.py
=====================================
"""
API ì„ íƒ ë° ê´€ë¦¬ í”„ë ˆì„
"""
from typing import Dict, Optional

from PyQt5.QtCore import pyqtSignal
from PyQt5.QtWidgets import (QComboBox, QDialog, QDialogButtonBox, QGridLayout,
                             QGroupBox, QHBoxLayout, QLabel, QLineEdit,
                             QMessageBox, QPushButton, QVBoxLayout)


class APIFrame(QGroupBox):
    """API ê´€ë¦¬ í”„ë ˆì„"""

    # ì‹œê·¸ë„ ì •ì˜
    api_selected = pyqtSignal(dict)
    api_registered = pyqtSignal(str)

    def __init__(self, api_manager):
        super().__init__("API ì„¤ì •")
        self.api_manager = api_manager
        self.current_api = None

        self.setup_ui()
        self.refresh_api_list()

    def setup_ui(self):
        """UI êµ¬ì„±"""
        layout = QHBoxLayout(self)

        # API ì„ íƒ ë ˆì´ë¸”
        layout.addWidget(QLabel("API ì„ íƒ:"))

        # API ì½¤ë³´ë°•ìŠ¤
        self.api_combo = QComboBox()
        self.api_combo.setMinimumWidth(200)
        self.api_combo.currentTextChanged.connect(self.on_api_changed)
        layout.addWidget(self.api_combo)

        # ìƒˆ API ë“±ë¡ ë²„íŠ¼
        self.register_btn = QPushButton("ìƒˆ API ë“±ë¡")
        self.register_btn.clicked.connect(self.show_register_dialog)
        layout.addWidget(self.register_btn)

        # API ì •ë³´ ë ˆì´ë¸”
        self.info_label = QLabel("APIë¥¼ ì„ íƒí•˜ì„¸ìš”")
        self.info_label.setStyleSheet("color: #ff9800;")
        layout.addWidget(self.info_label)

        # ì—¬ë°± ì¶”ê°€
        layout.addStretch()

    def refresh_api_list(self):
        """API ëª©ë¡ ìƒˆë¡œê³ ì¹¨"""
        self.api_combo.clear()
        apis = self.api_manager.list_apis()

        if apis:
            self.api_combo.addItems(apis)
            self.api_combo.setCurrentIndex(0)
            self.on_api_changed(apis[0])
        else:
            self.info_label.setText("ë“±ë¡ëœ APIê°€ ì—†ìŠµë‹ˆë‹¤")
            self.info_label.setStyleSheet("color: #f44336;")

    def on_api_changed(self, api_name: str):
        """API ì„ íƒ ë³€ê²½"""
        if api_name:
            api_config = self.api_manager.get_api(api_name)
            if api_config:
                self.current_api = api_config
                self.current_api['name'] = api_name
                self.info_label.setText(f"âœ“ {api_name}")
                self.info_label.setStyleSheet("color: #4CAF50;")
                self.api_selected.emit(self.current_api)

    def show_register_dialog(self):
        """API ë“±ë¡ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ"""
        dialog = APIRegisterDialog(self)
        if dialog.exec_():
            api_data = dialog.get_api_data()
            if api_data:
                self.api_manager.register_api(
                    api_data['name'],
                    api_data['api_id'],
                    api_data['api_hash']
                )
                self.api_registered.emit(api_data['name'])
                self.refresh_api_list()
                self.api_combo.setCurrentText(api_data['name'])

                QMessageBox.information(
                    self,
                    "ì„±ê³µ",
                    f"API '{api_data['name']}' ë“±ë¡ ì™„ë£Œ!"
                )


class APIRegisterDialog(QDialog):
    """API ë“±ë¡ ë‹¤ì´ì–¼ë¡œê·¸"""

    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowTitle("ìƒˆ API ë“±ë¡")
        self.setModal(True)
        self.setFixedSize(400, 200)

        self.setup_ui()

    def setup_ui(self):
        """UI êµ¬ì„±"""
        layout = QVBoxLayout(self)

        # ì…ë ¥ í•„ë“œ ê·¸ë¦¬ë“œ
        grid_layout = QGridLayout()

        # API ì´ë¦„
        grid_layout.addWidget(QLabel("API ì´ë¦„:"), 0, 0)
        self.name_input = QLineEdit()
        self.name_input.setPlaceholderText("ì˜ˆ: MyAPI")
        grid_layout.addWidget(self.name_input, 0, 1)

        # API ID
        grid_layout.addWidget(QLabel("API ID:"), 1, 0)
        self.api_id_input = QLineEdit()
        self.api_id_input.setPlaceholderText("ìˆ«ìë§Œ ì…ë ¥")
        grid_layout.addWidget(self.api_id_input, 1, 1)

        # API Hash
        grid_layout.addWidget(QLabel("API Hash:"), 2, 0)
        self.api_hash_input = QLineEdit()
        self.api_hash_input.setPlaceholderText("32ìë¦¬ ë¬¸ìì—´")
        grid_layout.addWidget(self.api_hash_input, 2, 1)

        layout.addLayout(grid_layout)

        # ë²„íŠ¼
        buttons = QDialogButtonBox(
            QDialogButtonBox.Ok | QDialogButtonBox.Cancel
        )
        buttons.accepted.connect(self.validate_and_accept)
        buttons.rejected.connect(self.reject)
        layout.addWidget(buttons)

        # ì²« ë²ˆì§¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
        self.name_input.setFocus()

    def validate_and_accept(self):
        """ì…ë ¥ ê²€ì¦ í›„ ìŠ¹ì¸"""
        name = self.name_input.text().strip()
        api_id = self.api_id_input.text().strip()
        api_hash = self.api_hash_input.text().strip()

        # ê²€ì¦
        if not name:
            QMessageBox.warning(self, "ê²½ê³ ", "API ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.")
            self.name_input.setFocus()
            return

        if not api_id:
            QMessageBox.warning(self, "ê²½ê³ ", "API IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
            self.api_id_input.setFocus()
            return

        if not api_id.isdigit():
            QMessageBox.warning(self, "ê²½ê³ ", "API IDëŠ” ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.")
            self.api_id_input.setFocus()
            return

        if not api_hash:
            QMessageBox.warning(self, "ê²½ê³ ", "API Hashë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
            self.api_hash_input.setFocus()
            return

        if len(api_hash) != 32:
            QMessageBox.warning(self, "ê²½ê³ ", "API HashëŠ” 32ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.")
            self.api_hash_input.setFocus()
            return

        self.accept()

    def get_api_data(self) -> Optional[Dict[str, str]]:
        """ì…ë ¥ëœ API ë°ì´í„° ë°˜í™˜"""
        if self.result() == QDialog.Accepted:
            return {
                'name': self.name_input.text().strip(),
                'api_id': self.api_id_input.text().strip(),
                'api_hash': self.api_hash_input.text().strip()
            }
        return None



=====================================
File: ./src/tg_session_manager/gui/widgets/input_frame.py
=====================================
"""
ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ ë° ì „í™”ë²ˆí˜¸ ì…ë ¥ í”„ë ˆì„
"""
import re
from typing import Dict, List

from PyQt5.QtCore import Qt, pyqtSignal
from PyQt5.QtGui import QTextCursor
from PyQt5.QtWidgets import (QCheckBox, QGroupBox, QHBoxLayout, QLabel,
                             QProgressBar, QPushButton, QTextEdit, QVBoxLayout)


class InputFrame(QGroupBox):
    """ì…ë ¥ í”„ë ˆì„"""

    # ì‹œê·¸ë„ ì •ì˜
    start_processing = pyqtSignal(dict)
    stop_processing = pyqtSignal()

    def __init__(self):
        super().__init__("ì„¸ì…˜ ìƒì„±")
        self.processing = False
        self.setup_ui()

    def setup_ui(self):
        """UI êµ¬ì„±"""
        layout = QVBoxLayout(self)

        # ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ
        lib_layout = QHBoxLayout()
        lib_layout.addWidget(QLabel("ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ:"))

        self.library_checkboxes = {}
        libraries = [
            ("Telethon", "telethon"),
            ("Pyrogram", "pyrogram"),
            ("TDLib", "tdlib"),
            ("Bot API", "telegram-bot")
        ]

        for display_name, lib_name in libraries:
            checkbox = QCheckBox(display_name)
            checkbox.setChecked(lib_name in ['telethon', 'pyrogram'])
            self.library_checkboxes[lib_name] = checkbox
            lib_layout.addWidget(checkbox)

        lib_layout.addStretch()
        layout.addLayout(lib_layout)

        # ì „í™”ë²ˆí˜¸ ì…ë ¥
        phone_label = QLabel("ì „í™”ë²ˆí˜¸ ì…ë ¥ (ì‰¼í‘œë¡œ êµ¬ë¶„):")
        layout.addWidget(phone_label)

        self.phone_input = PhoneNumberTextEdit()
        self.phone_input.setMaximumHeight(100)
        self.phone_input.setPlaceholderText(
            "ì˜ˆ: +82 10 1234 5678, +8210-8765-4321\n"
            "ë‹¤ì–‘í•œ í˜•ì‹ ì§€ì›: ê³µë°±, í•˜ì´í”ˆ ìë™ ì œê±°"
        )
        layout.addWidget(self.phone_input)

        # ë²„íŠ¼ ë ˆì´ì•„ì›ƒ
        button_layout = QHBoxLayout()

        self.start_btn = QPushButton("ì„¸ì…˜ ìƒì„± ì‹œì‘")
        self.start_btn.setObjectName("startButton")
        self.start_btn.clicked.connect(self.on_start_clicked)
        self.start_btn.setCursor(Qt.PointingHandCursor)
        button_layout.addWidget(self.start_btn)

        self.stop_btn = QPushButton("ì¤‘ì§€")
        self.stop_btn.clicked.connect(self.on_stop_clicked)
        self.stop_btn.setEnabled(False)
        self.stop_btn.setCursor(Qt.PointingHandCursor)
        button_layout.addWidget(self.stop_btn)

        button_layout.addStretch()
        layout.addLayout(button_layout)

        # ì§„í–‰ í‘œì‹œì¤„
        self.progress_bar = QProgressBar()
        self.progress_bar.setTextVisible(True)
        layout.addWidget(self.progress_bar)

    def on_start_clicked(self):
        """ì‹œì‘ ë²„íŠ¼ í´ë¦­"""
        # ì„ íƒëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
        selected_libraries = [
            lib_name for lib_name, checkbox in self.library_checkboxes.items()
            if checkbox.isChecked()
        ]

        # ì „í™”ë²ˆí˜¸ íŒŒì‹±
        phones = self.phone_input.get_phone_numbers()

        # ë°ì´í„° ì „ì†¡
        self.start_processing.emit({
            'libraries': selected_libraries,
            'phones': phones
        })

    def on_stop_clicked(self):
        """ì¤‘ì§€ ë²„íŠ¼ í´ë¦­"""
        self.stop_processing.emit()

    def set_processing(self, processing: bool):
        """ì²˜ë¦¬ ìƒíƒœ ì„¤ì •"""
        self.processing = processing
        self.start_btn.setEnabled(not processing)
        self.stop_btn.setEnabled(processing)

        # ì²´í¬ë°•ìŠ¤ í™œì„±í™”/ë¹„í™œì„±í™”
        for checkbox in self.library_checkboxes.values():
            checkbox.setEnabled(not processing)

        # ì „í™”ë²ˆí˜¸ ì…ë ¥ í™œì„±í™”/ë¹„í™œì„±í™”
        self.phone_input.setReadOnly(processing)

    def set_progress_max(self, value: int):
        """ì§„í–‰ í‘œì‹œì¤„ ìµœëŒ€ê°’ ì„¤ì •"""
        self.progress_bar.setMaximum(value)

    def set_progress_value(self, value: int):
        """ì§„í–‰ í‘œì‹œì¤„ ê°’ ì„¤ì •"""
        self.progress_bar.setValue(value)
        if self.progress_bar.maximum() > 0:
            percentage = (value / self.progress_bar.maximum()) * 100
            self.progress_bar.setFormat(f"{value}/{self.progress_bar.maximum()} ({percentage:.1f}%)")


class PhoneNumberTextEdit(QTextEdit):
    """ì „í™”ë²ˆí˜¸ ì…ë ¥ ìœ„ì ¯ - ìë™ í¬ë§·íŒ… ì§€ì›"""

    def __init__(self):
        super().__init__()
        self.textChanged.connect(self.format_phone_numbers)
        self.last_text = ""

    def format_phone_numbers(self):
        """ì…ë ¥ ì¤‘ ì „í™”ë²ˆí˜¸ í¬ë§·íŒ…"""
        current_text = self.toPlainText()

        # ë³€ê²½ì´ ì—†ìœ¼ë©´ ë¬´ì‹œ
        if current_text == self.last_text:
            return

        # ì»¤ì„œ ìœ„ì¹˜ ì €ì¥
        cursor = self.textCursor()
        cursor_pos = cursor.position()

        # í˜„ì¬ ì¤„ ì°¾ê¸°
        cursor.movePosition(QTextCursor.StartOfLine)
        line_start = cursor.position()
        cursor.movePosition(QTextCursor.EndOfLine)
        line_end = cursor.position()

        # í¬ë§·íŒ… ì ìš©í•˜ì§€ ì•Šì„ ê²½ìš°
        if cursor_pos < line_end:
            self.last_text = current_text
            return

        self.last_text = current_text

    def get_phone_numbers(self) -> List[str]:
        """ì „í™”ë²ˆí˜¸ ëª©ë¡ ë°˜í™˜ (í¬ë§·íŒ… ì ìš©)"""
        text = self.toPlainText()

        # ì‰¼í‘œë¡œ ë¶„ë¦¬
        raw_numbers = text.split(',')

        # ê° ë²ˆí˜¸ ì •ë¦¬
        cleaned_numbers = []
        for number in raw_numbers:
            cleaned = self.clean_phone_number(number.strip())
            if cleaned:
                cleaned_numbers.append(cleaned)

        return cleaned_numbers

    def clean_phone_number(self, phone: str) -> str:
        """ì „í™”ë²ˆí˜¸ ì •ë¦¬ - ê³µë°±, í•˜ì´í”ˆ ë“± ì œê±°"""
        if not phone:
            return ""

        # ìˆ«ìì™€ + ê¸°í˜¸ë§Œ ë‚¨ê¸°ê¸°
        cleaned = re.sub(r'[^\d+]', '', phone)

        # + ê¸°í˜¸ê°€ ë§¨ ì•ì—ë§Œ ìˆë„ë¡ í™•ì¸
        if '+' in cleaned[1:]:
            cleaned = '+' + cleaned.replace('+', '')

        # ìµœì†Œ ê¸¸ì´ í™•ì¸ (êµ­ê°€ ì½”ë“œ + ìµœì†Œ ë²ˆí˜¸)
        if len(cleaned) < 8:
            return ""

        return cleaneddmd



=====================================
File: ./src/tg_session_manager/gui/widgets/result_frame.py
=====================================
"""
ê²°ê³¼ í‘œì‹œ í”„ë ˆì„ - íŠ¸ë¦¬ë·°ì™€ ë¡œê·¸
"""
from datetime import datetime
from typing import Dict, List

from PyQt5.QtCore import Qt, pyqtSignal
from PyQt5.QtGui import QColor
from PyQt5.QtWidgets import (QGroupBox, QHBoxLayout, QHeaderView, QMenu,
                             QPushButton, QTabWidget, QTextEdit, QTreeWidget,
                             QTreeWidgetItem, QVBoxLayout)


class ResultFrame(QGroupBox):
    """ê²°ê³¼ í‘œì‹œ í”„ë ˆì„"""

    # ì‹œê·¸ë„ ì •ì˜
    copy_requested = pyqtSignal(str, str)  # phone, library
    export_requested = pyqtSignal()
    clear_requested = pyqtSignal()
    session_double_clicked = pyqtSignal(str, str)  # phone, library

    def __init__(self):
        super().__init__("ì„¸ì…˜ ë¬¸ìì—´ ê²°ê³¼")
        self.results = []
        self.setup_ui()

    def setup_ui(self):
        """UI êµ¬ì„±"""
        layout = QVBoxLayout(self)

        # íƒ­ ìœ„ì ¯
        self.tab_widget = QTabWidget()
        layout.addWidget(self.tab_widget)

        # ê²°ê³¼ íƒ­
        self.result_tree = QTreeWidget()
        self.setup_result_tree()
        self.tab_widget.addTab(self.result_tree, "ìƒì„±ëœ ì„¸ì…˜")

        # ë¡œê·¸ íƒ­
        self.log_text = QTextEdit()
        self.log_text.setReadOnly(True)
        self.tab_widget.addTab(self.log_text, "ë¡œê·¸")

        # ë²„íŠ¼ ë ˆì´ì•„ì›ƒ
        button_layout = QHBoxLayout()

        copy_btn = QPushButton("ì„ íƒ í•­ëª© ë³µì‚¬")
        copy_btn.clicked.connect(self.copy_selected)
        button_layout.addWidget(copy_btn)

        export_btn = QPushButton("ëª¨ë‘ ë‚´ë³´ë‚´ê¸°")
        export_btn.clicked.connect(self.export_requested.emit)
        button_layout.addWidget(export_btn)

        clear_btn = QPushButton("ê²°ê³¼ ì§€ìš°ê¸°")
        clear_btn.clicked.connect(self.clear_results)
        button_layout.addWidget(clear_btn)

        button_layout.addStretch()
        layout.addLayout(button_layout)

    def setup_result_tree(self):
        """ê²°ê³¼ íŠ¸ë¦¬ ì„¤ì •"""
        # ì»¬ëŸ¼ ì„¤ì •
        headers = ["ì „í™”ë²ˆí˜¸", "ë¼ì´ë¸ŒëŸ¬ë¦¬", "ìƒíƒœ", "ì„¸ì…˜ ë¬¸ìì—´"]
        self.result_tree.setHeaderLabels(headers)

        # í—¤ë” ì„¤ì •
        header = self.result_tree.header()
        header.setSectionResizeMode(0, QHeaderView.ResizeToContents)
        header.setSectionResizeMode(1, QHeaderView.ResizeToContents)
        header.setSectionResizeMode(2, QHeaderView.ResizeToContents)
        header.setSectionResizeMode(3, QHeaderView.Stretch)

        # ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸
        self.result_tree.itemDoubleClicked.connect(self.on_item_double_clicked)

        # ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´
        self.result_tree.setContextMenuPolicy(Qt.CustomContextMenu)
        self.result_tree.customContextMenuRequested.connect(self.show_context_menu)

    def add_result(self, result: Dict):
        """ê²°ê³¼ ì¶”ê°€"""
        item = QTreeWidgetItem([
            result['phone'],
            result['library'],
            result['status'],
            result['string_preview']
        ])

        # ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
        if result['status'] == 'ì„±ê³µ':
            item.setForeground(2, QColor("#4CAF50"))
        else:
            item.setForeground(2, QColor("#f44336"))

        self.result_tree.addTopLevelItem(item)
        self.results.append(result)

        # ê²°ê³¼ íƒ­ìœ¼ë¡œ ì „í™˜
        self.tab_widget.setCurrentIndex(0)

    def add_log(self, message: str):
        """ë¡œê·¸ ì¶”ê°€"""
        timestamp = datetime.now().strftime("%H:%M:%S")
        self.log_text.append(f"[{timestamp}] {message}")

    def copy_selected(self):
        """ì„ íƒëœ í•­ëª© ë³µì‚¬"""
        current_item = self.result_tree.currentItem()
        if current_item:
            phone = current_item.text(0)
            library = current_item.text(1)
            status = current_item.text(2)

            if status == 'ì„±ê³µ':
                self.copy_requested.emit(phone, library)

    def clear_results(self):
        """ê²°ê³¼ ì´ˆê¸°í™”"""
        self.result_tree.clear()
        self.results.clear()
        self.clear_requested.emit()

    def on_item_double_clicked(self, item: QTreeWidgetItem, column: int):
        """ì•„ì´í…œ ë”ë¸”í´ë¦­"""
        phone = item.text(0)
        library = item.text(1)
        status = item.text(2)

        if status == 'ì„±ê³µ':
            self.session_double_clicked.emit(phone, library)

    def show_context_menu(self, position):
        """ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ"""
        item = self.result_tree.itemAt(position)
        if not item:
            return

        menu = QMenu()

        # ë³µì‚¬ ì•¡ì…˜
        if item.text(2) == 'ì„±ê³µ':
            copy_action = menu.addAction("ì„¸ì…˜ ë¬¸ìì—´ ë³µì‚¬")
            copy_action.triggered.connect(lambda: self.copy_requested.emit(
                item.text(0), item.text(1)
            ))

            view_action = menu.addAction("ìƒì„¸ ë³´ê¸°")
            view_action.triggered.connect(lambda: self.session_double_clicked.emit(
                item.text(0), item.text(1)
            ))

        menu.exec_(self.result_tree.mapToGlobal(position))

    def get_all_results(self) -> List[Dict]:
        """ëª¨ë“  ê²°ê³¼ ë°˜í™˜"""
        return self.results



=====================================
File: ./src/tg_session_manager/gui/workers/__init__.py
=====================================



=====================================
File: ./src/tg_session_manager/gui/workers/session_worker.py
=====================================
"""
ë°±ê·¸ë¼ìš´ë“œ ì„¸ì…˜ ìƒì„± ì›Œì»¤
"""
import asyncio
import tempfile
from typing import Dict, List, Optional

from core.session_factory import SessionFactory
from PyQt5.QtCore import QMutex, QObject, QWaitCondition, pyqtSignal
from utils.session_utils import extract_session_name


class SessionWorker(QObject):
    """ì„¸ì…˜ ìƒì„± ì›Œì»¤"""

    # ì‹œê·¸ë„ ì •ì˜
    progress = pyqtSignal(int)
    session_created = pyqtSignal(dict)
    log_message = pyqtSignal(str)
    auth_required = pyqtSignal(dict)
    finished = pyqtSignal()

    def __init__(self, api_config: Dict, libraries: List[str], phones: List[str]):
        super().__init__()
        self.api_config = api_config
        self.libraries = libraries
        self.phones = phones
        self.stopped = False
        self.completed = 0
        self.total = len(libraries) * len(phones)

        # ì¸ì¦ ëŒ€ê¸°ë¥¼ ìœ„í•œ ë™ê¸°í™” ê°ì²´
        self.auth_mutex = QMutex()
        self.auth_condition = QWaitCondition()
        self.auth_data = None

    def run(self):
        """ì›Œì»¤ ì‹¤í–‰"""
        # ìƒˆ ì´ë²¤íŠ¸ ë£¨í”„ ìƒì„±
        loop = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)

        try:
            loop.run_until_complete(self.process_all())
        finally:
            loop.close()
            self.finished.emit()

    async def process_all(self):
        """ëª¨ë“  ì„¸ì…˜ ì²˜ë¦¬"""
        for library in self.libraries:
            for phone in self.phones:
                if self.stopped:
                    self.log_message.emit("ì²˜ë¦¬ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.")
                    return

                await self.create_single_session(library, phone)

                self.completed += 1
                self.progress.emit(self.completed)

    async def create_single_session(self, library: str, phone: str):
        """ë‹¨ì¼ ì„¸ì…˜ ìƒì„±"""
        self.log_message.emit(f"[{library}] {phone} ì„¸ì…˜ ìƒì„± ì‹œì‘...")

        try:
            # ì„¸ì…˜ ë§¤ë‹ˆì € ìƒì„±
            manager = SessionFactory.create_session_manager(
                library,
                self.api_config['api_id'],
                self.api_config['api_hash']
            )

            if not manager:
                self.session_created.emit({
                    'phone': phone,
                    'library': library,
                    'success': False,
                    'error': 'ì„¸ì…˜ ë§¤ë‹ˆì € ìƒì„± ì‹¤íŒ¨'
                })
                return

            # ì¸ì¦ ìš”ì²­ ì‹œê·¸ë„ ë°œìƒ
            self.auth_required.emit({
                'library': library,
                'phone': phone
            })

            # ì¸ì¦ ë°ì´í„° ëŒ€ê¸°
            self.auth_mutex.lock()
            self.auth_condition.wait(self.auth_mutex)
            auth_data = self.auth_data
            self.auth_data = None
            self.auth_mutex.unlock()

            if not auth_data:
                self.session_created.emit({
                    'phone': phone,
                    'library': library,
                    'success': False,
                    'error': 'ì¸ì¦ ì·¨ì†Œë¨'
                })
                return

            # ì½œë°± í•¨ìˆ˜ ì •ì˜
            def code_callback():
                return auth_data.get('code')

            def password_callback():
                return auth_data.get('password')

            # ì„¸ì…˜ ìƒì„± (ì„ì‹œ ë””ë ‰í† ë¦¬ ì‚¬ìš©)
            with tempfile.TemporaryDirectory() as temp_dir:
                manager.session_dir = temp_dir

                success = await manager.create_session(
                    phone, code_callback, password_callback
                )

                if success:
                    # Base64 ë¬¸ìì—´ ìƒì„±
                    session_string = manager.session_to_string(phone)

                    if session_string:
                        self.session_created.emit({
                            'phone': phone,
                            'library': library,
                            'success': True,
                            'session_string': session_string
                        })
                        self.log_message.emit(
                            f"âœ“ [{library}] {phone} ì„¸ì…˜ ìƒì„± ì„±ê³µ"
                        )
                    else:
                        self.session_created.emit({
                            'phone': phone,
                            'library': library,
                            'success': False,
                            'error': 'ì„¸ì…˜ ë¬¸ìì—´ ìƒì„± ì‹¤íŒ¨'
                        })
                else:
                    self.session_created.emit({
                        'phone': phone,
                        'library': library,
                        'success': False,
                        'error': 'ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨'
                    })

        except Exception as e:
            self.log_message.emit(f"ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
            self.session_created.emit({
                'phone': phone,
                'library': library,
                'success': False,
                'error': str(e)
            })

    def provide_auth(self, auth_data: Optional[Dict]):
        """ì¸ì¦ ë°ì´í„° ì œê³µ"""
        self.auth_mutex.lock()
        self.auth_data = auth_data
        self.auth_condition.wakeAll()
        self.auth_mutex.unlock()

    def stop(self):
        """ì²˜ë¦¬ ì¤‘ì§€"""
        self.stopped = True



=====================================
File: ./src/tg_session_manager/lib/__init__.py
=====================================



=====================================
File: ./src/tg_session_manager/lib/pyrogram_session.py
=====================================
"""
Pyrogram ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ ì„¸ì…˜ ê´€ë¦¬
"""

import os
from typing import Dict, Optional

from core.session_base import SessionBase
from utils.session_utils import (extract_session_name, session_to_base64,
                           validate_session_file)


class PyrogramSession(SessionBase):
    """Pyrogram ì„¸ì…˜ ë§¤ë‹ˆì €"""

    async def create_session(
        self, phone_number: str, code_callback=None, password_callback=None
    ) -> bool:
        """Pyrogram ì„¸ì…˜ ìƒì„±"""
        try:
            from pyrogram import Client
            from pyrogram.errors import SessionPasswordNeeded

            session_name = extract_session_name(phone_number)

            app = Client(
                session_name,
                api_id=int(self.api_id),
                api_hash=self.api_hash,
                workdir=self.session_dir,
                phone_number=phone_number,
            )

            await app.connect()

            if not await app.is_user_authorized():
                sent_code = await app.send_code(phone_number)

                # ì¸ì¦ ì½”ë“œ ì…ë ¥
                if code_callback:
                    code = code_callback()
                    try:
                        await app.sign_in(phone_number, sent_code.phone_code_hash, code)
                    except SessionPasswordNeeded:
                        # 2FA ì²˜ë¦¬
                        if password_callback:
                            password = password_callback()
                            await app.check_password(password)

            await app.disconnect()
            return True

        except Exception as e:
            print(f"Pyrogram ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨: {e}")
            return False

    def session_to_string(self, phone_number: str) -> Optional[str]:
        """ì„¸ì…˜ì„ base64 ë¬¸ìì—´ë¡œ ë³€í™˜"""
        session_name = extract_session_name(phone_number)
        session_path = os.path.join(self.session_dir, f"{session_name}.session")
        return session_to_base64(session_path)

    def validate_session(self, phone_number: str) -> bool:
        """ì„¸ì…˜ ìœ íš¨ì„± ê²€ì‚¬"""
        session_name = extract_session_name(phone_number)
        session_path = os.path.join(self.session_dir, f"{session_name}.session")
        return validate_session_file(session_path)

    def get_session_info(self, phone_number: str) -> Optional[Dict]:
        """ì„¸ì…˜ ì •ë³´ ì¡°íšŒ"""
        if self.validate_session(phone_number):
            return {"library": "pyrogram", "phone": phone_number, "valid": True}
        return None



=====================================
File: ./src/tg_session_manager/lib/tdlib_session.py
=====================================
"""
TDLib ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ ì„¸ì…˜ ê´€ë¦¬
"""

import asyncio
import json
import os
from typing import Dict, Optional

from core.session_base import SessionBase
from utils.session_utils import (extract_session_name, session_to_base64,
                           validate_session_file)


class TDLibSession(SessionBase):
    """TDLib ì„¸ì…˜ ë§¤ë‹ˆì €"""

    def __init__(self, api_id: str, api_hash: str, session_dir: str):
        super().__init__(api_id, api_hash, session_dir)
        self.td_client = None

    async def create_session(
        self, phone_number: str, code_callback=None, password_callback=None
    ) -> bool:
        """TDLib ì„¸ì…˜ ìƒì„±"""
        try:
            from telegram.client import Telegram

            session_name = extract_session_name(phone_number)
            db_path = os.path.join(self.session_dir, session_name)

            # TDLib í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
            tg = Telegram(
                api_id=self.api_id,
                api_hash=self.api_hash,
                phone=phone_number,
                database_directory=db_path,
                files_directory=os.path.join(db_path, "files"),
                use_message_database=True,
                use_secret_chats=True,
                system_language_code="ko",
                device_model="Desktop",
                application_version="1.0",
            )

            # ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
            tg.login()

            # ì¸ì¦ ëŒ€ê¸°
            state = tg.get_authorization_state()

            if state["@type"] == "authorizationStateWaitPhoneNumber":
                # ì „í™”ë²ˆí˜¸ ì…ë ¥
                tg.send_phone_number(phone_number)
                state = tg.get_authorization_state()

            if state["@type"] == "authorizationStateWaitCode":
                # ì¸ì¦ ì½”ë“œ ì…ë ¥
                if code_callback:
                    code = code_callback()
                    tg.send_code(code)
                    state = tg.get_authorization_state()

            if state["@type"] == "authorizationStateWaitPassword":
                # 2FA ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
                if password_callback:
                    password = password_callback()
                    tg.send_password(password)
                    state = tg.get_authorization_state()

            # ë¡œê·¸ì¸ ì™„ë£Œ í™•ì¸
            if state["@type"] == "authorizationStateReady":
                print("âœ“ TDLib ì„¸ì…˜ ìƒì„± ì„±ê³µ!")

                # ì„¸ì…˜ ì •ë³´ ì €ì¥
                session_info = {
                    "phone_number": phone_number,
                    "api_id": self.api_id,
                    "api_hash": self.api_hash,
                    "db_path": db_path,
                    "library": "tdlib",
                }

                info_path = os.path.join(self.session_dir, f"{session_name}_info.json")
                with open(info_path, "w") as f:
                    json.dump(session_info, f, indent=2)

                tg.stop()
                return True

            tg.stop()
            return False

        except ImportError:
            print("python-telegram íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
            print("pip install python-telegram ëª…ë ¹ìœ¼ë¡œ ì„¤ì¹˜í•´ì£¼ì„¸ìš”.")
            return False
        except Exception as e:
            print(f"TDLib ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨: {e}")
            return False

    def session_to_string(self, phone_number: str) -> Optional[str]:
        """ì„¸ì…˜ì„ base64 ë¬¸ìì—´ë¡œ ë³€í™˜"""
        session_name = extract_session_name(phone_number)
        info_path = os.path.join(self.session_dir, f"{session_name}_info.json")
        return session_to_base64(info_path)

    def validate_session(self, phone_number: str) -> bool:
        """ì„¸ì…˜ ìœ íš¨ì„± ê²€ì‚¬"""
        session_name = extract_session_name(phone_number)
        db_path = os.path.join(self.session_dir, session_name)
        info_path = os.path.join(self.session_dir, f"{session_name}_info.json")

        # TDLib ë°ì´í„°ë² ì´ìŠ¤ì™€ ì •ë³´ íŒŒì¼ ëª¨ë‘ í™•ì¸
        return os.path.exists(db_path) and os.path.exists(info_path)

    def get_session_info(self, phone_number: str) -> Optional[Dict]:
        """ì„¸ì…˜ ì •ë³´ ì¡°íšŒ"""
        if self.validate_session(phone_number):
            session_name = extract_session_name(phone_number)
            info_path = os.path.join(self.session_dir, f"{session_name}_info.json")

            try:
                with open(info_path, "r") as f:
                    info = json.load(f)
                    info["valid"] = True
                    return info
            except BaseException:
                pass

        return None



=====================================
File: ./src/tg_session_manager/lib/telegram_bot_session.py
=====================================
"""
python-telegram-bot ê³µì‹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ ì„¸ì…˜ ê´€ë¦¬
"""

import asyncio
import json
import os
from typing import Dict, Optional

from core.session_base import SessionBase
from utils.session_utils import (extract_session_name, session_to_base64,
                           validate_session_file)


class TelegramBotSession(SessionBase):
    """python-telegram-bot ì„¸ì…˜ ë§¤ë‹ˆì €"""

    async def create_session(
        self, phone_number: str, code_callback=None, password_callback=None
    ) -> bool:
        """python-telegram-botì€ ì£¼ë¡œ ë´‡ìš©ì´ë¯€ë¡œ ìœ ì € ì„¸ì…˜ ë¯¸ì§€ì›"""
        print("python-telegram-botì€ ì£¼ë¡œ ë´‡ ê°œë°œìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.")
        print("ìœ ì € ì„¸ì…˜ ìƒì„±ì€ Telethon ë˜ëŠ” Pyrogramì„ ì‚¬ìš©í•˜ì„¸ìš”.")

        # ë¹„ë™ê¸° ì…ë ¥ì„ ìœ„í•œ í—¬í¼ í•¨ìˆ˜
        async def async_input(prompt: str) -> str:
            loop = asyncio.get_event_loop()
            return await loop.run_in_executor(None, input, prompt)

        # ëŒ€ì‹  ë´‡ í† í°ìœ¼ë¡œ ì„¸ì…˜ ì •ë³´ ì €ì¥ ê°€ëŠ¥
        token = await async_input("ë´‡ í† í°ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­, Enterë¡œ ê±´ë„ˆë›°ê¸°): ")
        if token:
            session_name = extract_session_name(phone_number)
            session_path = os.path.join(self.session_dir, f"{session_name}.json")

            session_data = {
                "bot_token": token,
                "phone_number": phone_number,
                "api_id": self.api_id,
                "api_hash": self.api_hash,
                "type": "bot",
            }

            try:
                # ë¹„ë™ê¸° íŒŒì¼ ì“°ê¸°
                await self._async_write_json(session_path, session_data)
                print("âœ“ ë´‡ ì„¸ì…˜ ì •ë³´ ì €ì¥ ì™„ë£Œ")
                return True
            except Exception as e:
                print(f"ì„¸ì…˜ ì €ì¥ ì‹¤íŒ¨: {e}")

        return False

    async def _async_write_json(self, filepath: str, data: dict) -> None:
        """ë¹„ë™ê¸°ë¡œ JSON íŒŒì¼ ì“°ê¸°"""
        loop = asyncio.get_event_loop()

        def write_json():
            with open(filepath, "w") as f:
                json.dump(data, f, indent=2)

        await loop.run_in_executor(None, write_json)

    async def _async_read_json(self, filepath: str) -> dict:
        """ë¹„ë™ê¸°ë¡œ JSON íŒŒì¼ ì½ê¸°"""
        loop = asyncio.get_event_loop()

        def read_json():
            with open(filepath, "r") as f:
                return json.load(f)

        return await loop.run_in_executor(None, read_json)

    def session_to_string(self, phone_number: str) -> Optional[str]:
        """ì„¸ì…˜ì„ base64 ë¬¸ìì—´ë¡œ ë³€í™˜"""
        session_name = extract_session_name(phone_number)
        session_path = os.path.join(self.session_dir, f"{session_name}.json")
        return session_to_base64(session_path)

    def validate_session(self, phone_number: str) -> bool:
        """ì„¸ì…˜ ìœ íš¨ì„± ê²€ì‚¬"""
        session_name = extract_session_name(phone_number)
        session_path = os.path.join(self.session_dir, f"{session_name}.json")

        if os.path.exists(session_path):
            try:
                with open(session_path, "r") as f:
                    data = json.load(f)
                    return "bot_token" in data
            except (json.JSONDecodeError, IOError, OSError) as e:
                print(f"ì„¸ì…˜ ê²€ì¦ ì‹¤íŒ¨: {e}")
                return False
        return False

    def get_session_info(self, phone_number: str) -> Optional[Dict]:
        """ì„¸ì…˜ ì •ë³´ ì¡°íšŒ"""
        if self.validate_session(phone_number):
            return {
                "library": "python-telegram-bot",
                "phone": phone_number,
                "type": "bot",
                "valid": True,
            }
        return None



=====================================
File: ./src/tg_session_manager/lib/telethon_session.py
=====================================
"""
Telethon ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ ì„¸ì…˜ ê´€ë¦¬
"""

import os
from typing import Dict, Optional

from core.session_base import SessionBase
from utils.session_utils import (extract_session_name, session_to_base64,
                           validate_session_file)


class TelethonSession(SessionBase):
    """Telethon ì„¸ì…˜ ë§¤ë‹ˆì €"""

    async def create_session(
        self, phone_number: str, code_callback=None, password_callback=None
    ) -> bool:
        """Telethon ì„¸ì…˜ ìƒì„±"""
        try:
            from telethon import TelegramClient
            from telethon.errors import SessionPasswordNeededError

            session_name = extract_session_name(phone_number)
            session_path = os.path.join(self.session_dir, session_name)

            client = TelegramClient(session_path, int(self.api_id), self.api_hash)

            await client.connect()

            if not await client.is_user_authorized():
                await client.send_code_request(phone_number)

                # ì¸ì¦ ì½”ë“œ ì…ë ¥
                if code_callback:
                    code = code_callback()
                    try:
                        await client.sign_in(phone_number, code)
                    except SessionPasswordNeededError:
                        # 2FA ì²˜ë¦¬
                        if password_callback:
                            password = password_callback()
                            await client.sign_in(password=password)

            await client.disconnect()
            return True

        except Exception as e:
            print(f"Telethon ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨: {e}")
            return False

    def session_to_string(self, phone_number: str) -> Optional[str]:
        """ì„¸ì…˜ì„ base64 ë¬¸ìì—´ë¡œ ë³€í™˜"""
        session_name = extract_session_name(phone_number)
        session_path = os.path.join(self.session_dir, f"{session_name}.session")
        return session_to_base64(session_path)

    def validate_session(self, phone_number: str) -> bool:
        """ì„¸ì…˜ ìœ íš¨ì„± ê²€ì‚¬"""
        session_name = extract_session_name(phone_number)
        session_path = os.path.join(self.session_dir, f"{session_name}.session")
        return validate_session_file(session_path)

    def get_session_info(self, phone_number: str) -> Optional[Dict]:
        """ì„¸ì…˜ ì •ë³´ ì¡°íšŒ"""
        if self.validate_session(phone_number):
            return {"library": "telethon", "phone": phone_number, "valid": True}
        return None



=====================================
File: ./src/tg_session_manager/run_cli.py
=====================================



=====================================
File: ./src/tg_session_manager/run_gui.py
=====================================



=====================================
File: ./src/tg_session_manager/utils/__init__.py
=====================================



=====================================
File: ./src/tg_session_manager/utils/logger.py
=====================================
"""
ë¡œê¹… ì‹œìŠ¤í…œ - ì„¸ì…˜ ìƒì„±/ì‹¤íŒ¨/ì‚­ì œ ë“± ì´ë²¤íŠ¸ ê¸°ë¡
"""

import logging
import os
from datetime import datetime
from typing import Optional

from config.config import BASE_DIR


class SessionLogger:
    """ì„¸ì…˜ ê´€ë¦¬ ë¡œê±°"""

    def __init__(self, log_file: Optional[str] = None):
        if log_file is None:
            log_dir = os.path.join(BASE_DIR, "logs")
            os.makedirs(log_dir, exist_ok=True)
            log_file = os.path.join(
                log_dir, f"session_{datetime.now().strftime('%Y%m%d')}.log"
            )

        # ë¡œê±° ì„¤ì •
        self.logger = logging.getLogger("SessionManager")
        self.logger.setLevel(logging.INFO)

        # íŒŒì¼ í•¸ë“¤ëŸ¬
        file_handler = logging.FileHandler(log_file, encoding="utf-8")
        file_handler.setLevel(logging.INFO)

        # ì½˜ì†” í•¸ë“¤ëŸ¬
        console_handler = logging.StreamHandler()
        console_handler.setLevel(logging.WARNING)

        # í¬ë§·í„°
        formatter = logging.Formatter(
            "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
        )
        file_handler.setFormatter(formatter)
        console_handler.setFormatter(formatter)

        # í•¸ë“¤ëŸ¬ ì¶”ê°€
        self.logger.addHandler(file_handler)
        self.logger.addHandler(console_handler)

    def log_session_created(self, library: str, phone: str, success: bool):
        """ì„¸ì…˜ ìƒì„± ë¡œê·¸"""
        if success:
            self.logger.info("ì„¸ì…˜ ìƒì„± ì„±ê³µ: %s - %s", library, phone)
        else:
            self.logger.error("ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨: %s - %s", library, phone)

    def log_authentication(self, phone: str, attempt: int, success: bool):
        """ì¸ì¦ ì‹œë„ ë¡œê·¸"""
        if success:
            self.logger.info("ì¸ì¦ ì„±ê³µ: %s (ì‹œë„ %d)", phone, attempt)
        else:
            self.logger.warning("ì¸ì¦ ì‹¤íŒ¨: %s (ì‹œë„ %d)", phone, attempt)

    def log_backup(self, original_path: str, backup_path: str):
        """ë°±ì—… ë¡œê·¸"""
        self.logger.info("ì„¸ì…˜ ë°±ì—…: %s -> %s", original_path, backup_path)

    def log_api_registered(self, api_name: str):
        """API ë“±ë¡ ë¡œê·¸"""
        self.logger.info("API ë“±ë¡: %s", api_name)

    def log_error(self, error_msg: str):
        """ì—ëŸ¬ ë¡œê·¸"""
        self.logger.error("ì—ëŸ¬: %s", error_msg)



=====================================
File: ./src/tg_session_manager/utils/session_utils.py
=====================================
"""
ì„¸ì…˜ ìœ í‹¸ë¦¬í‹° - ì„¸ì…˜ëª… ì¶”ì¶œ, base64 ë³€í™˜, ìœ íš¨ì„± ê²€ì‚¬
"""

import base64
import os
import shutil
from datetime import datetime
from typing import Optional


def extract_session_name(phone_number: str) -> str:
    """ì „í™”ë²ˆí˜¸ì—ì„œ ì„¸ì…˜ëª… ì¶”ì¶œ (ë’· 8ìë¦¬)"""
    # ìˆ«ìë§Œ ì¶”ì¶œ
    numbers_only = "".join(filter(str.isdigit, phone_number))
    # ë’· 8ìë¦¬ ë°˜í™˜, 8ìë¦¬ ë¯¸ë§Œì´ë©´ ì „ì²´ ë°˜í™˜
    return numbers_only[-8:] if len(numbers_only) >= 8 else numbers_only


def session_to_base64(session_file_path: str) -> Optional[str]:
    """ì„¸ì…˜ íŒŒì¼ì„ base64 ë¬¸ìì—´ë¡œ ë³€í™˜"""
    try:
        if os.path.exists(session_file_path):
            with open(session_file_path, "rb") as f:
                return base64.b64encode(f.read()).decode("utf-8")
    except (IOError, OSError) as e:
        print(f"ì„¸ì…˜ íŒŒì¼ ë³€í™˜ ì‹¤íŒ¨: {e}")
    return None


def base64_to_session(base64_string: str, output_path: str) -> bool:
    """base64 ë¬¸ìì—´ì„ ì„¸ì…˜ íŒŒì¼ë¡œ ë³µêµ¬"""
    try:
        session_data = base64.b64decode(base64_string)
        with open(output_path, "wb") as f:
            f.write(session_data)
        return True
    except (ValueError, IOError, OSError) as e:
        print(f"ì„¸ì…˜ ë³µêµ¬ ì‹¤íŒ¨: {e}")
        return False


def validate_session_file(session_file_path: str) -> bool:
    """ì„¸ì…˜ íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬"""
    # íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ì™€ í¬ê¸° í™•ì¸
    if os.path.exists(session_file_path):
        file_size = os.path.getsize(session_file_path)
        return file_size > 0
    return False


def backup_existing_session(session_file_path: str) -> Optional[str]:
    """ê¸°ì¡´ ì„¸ì…˜ íŒŒì¼ ë°±ì—…"""
    if os.path.exists(session_file_path):
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_path = f"{session_file_path}.backup_{timestamp}"
        try:
            shutil.copy2(session_file_path, backup_path)
            return backup_path
        except (IOError, OSError) as e:
            print(f"ì„¸ì…˜ ë°±ì—… ì‹¤íŒ¨: {e}")
    return None



